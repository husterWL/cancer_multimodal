## å¼€å§‹ä½¿ç”¨ Raccoon Notebook

Raccoon Notebook ä¸ºæ‚¨æä¾›äº†äº¤äº’å¼çš„ä»£ç æ‰§è¡Œä½“éªŒï¼Œå¸®åŠ©æ‚¨å¿«é€ŸéªŒè¯æƒ³æ³•ï¼Œæˆ–æ²‰æ·€æœ‰ç”¨çš„æµç¨‹ã€‚

åœ¨ Raccoon Notebook ä¸­ï¼Œæ‚¨å¯ä»¥åˆ›å»º `Markdown` æ ¼å¼çš„å•å…ƒæ ¼ï¼Œæ¥è®°å½•è¯´æ˜æ€§æ–‡å­—ï¼ŒåŒæ—¶å¯ä»¥åœ¨å…¶ä¸­ç©¿æ’åˆ›å»ºä»£ç å•å…ƒæ ¼ï¼Œå…¶ä¸­å¯ä»¥åŒ…å« `Raccoon æŒ‡ä»¤` æˆ– `TypeScript` ä»£ç ï¼Œå¹¶æ”¯æŒç¼–è¾‘ä¿®æ”¹å’Œå®æ—¶è¿è¡Œï¼Œå¿«é€ŸæŸ¥çœ‹è¾“å‡ºç»“æœã€‚

### æ”¯æŒçš„æ¨¡å—å’Œæ¥å£

æ‰€æœ‰æŒ‡ä»¤æˆ–æ¥å£çš†ä¼šè¿”å›ä¸€ä¸ª `Message` ç»“æ„ï¼š

```ts readonly
interface Message {
  role: string;
  content: string;
}
```

Raccoon Notebook ä¸ºæ¯ä¸ªå•å…ƒæ ¼æä¾›äº† `RaccoonContext` ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå…¶ä¸­æä¾›äº†å·¥å…·å‡½æ•°å…¥å£åŠå·²è¿è¡Œå•å…ƒæ ¼çš„è¾“å‡ºä¿¡æ¯ï¼Œå…¶è¯¦ç»†å®šä¹‰å¦‚ä¸‹:

```ts readonly
interface RaccoonContext {
  llm: any; // LLM å·¥å…·å‡½æ•°å…¥å£
  ide: any; // IDE å·¥å…·å‡½æ•°å…¥å£
  output: { // output æ˜ å°„ï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œåçš„è¾“å‡ºç´¢å¼•å·è·å–å¯¹åº”çš„æ¶ˆæ¯
    [key: number]: Message; // ä»¥ Cell Index ä¸º key çš„è¾“å‡ºæ¶ˆæ¯æ˜ å°„
  };
  outputs: Message[]; // å‰åºæ‰€æœ‰è¾“å‡ºæ¶ˆæ¯çš„åˆ—è¡¨
}
```

ä»¥ä¸‹æ˜¯å½“å‰æ”¯æŒçš„å·¥å…·å‡½æ•°åˆ—è¡¨ï¼š

| Raccoon Directive   | TypeScript Interface                           | Description                                                                                 |
|---------------------|------------------------------------------------|---------------------------------------------------------------------------------------------|
| `@llm.assistant`    | `llm.assistant({messages: Message[]})`         | è°ƒç”¨è¿œç«¯è¯­è¨€æ¨¡å‹é—®ç­”æ¥å£, å‚æ•°ä¸ºéœ€è¦å‘é€çš„å¯¹è¯æ¶ˆæ¯åˆ—è¡¨, æœ€åä¸€æ¡æ¶ˆæ¯çš„ `role` å¿…é¡»ä¸º `user` |
| `@llm.completion`   | `llm.completion({prompt: string})`             | è°ƒç”¨è¿œç«¯è¯­è¨€æ¨¡å‹è¡¥å…¨æ¥å£, å‚æ•°ä¸ºéœ€è¦å‘é€çš„æç¤ºå†…å®¹                                          |
| `@ide.input`        | `ide.input({prompt: string})`                  | è¯·æ±‚ç”¨æˆ·è¾“å…¥, å‚æ•°ä¸ºæç¤ºä¿¡æ¯å†…å®¹                                                            |
| `@ide.select`       | `ide.select({items: string[]; title: string})` | è¯·æ±‚ç”¨æˆ·è¾“å…¥, å‚æ•°ä¸ºæç¤ºä¿¡æ¯å†…å®¹                                                            |
| `@ide.files`        | `ide.files({recursive: number})`               | åˆ—ä¸¾å½“å‰å·¥ä½œç›®å½•æ–‡ä»¶, å‚æ•°ä¸ºæœ€å¤§éå†æ·±åº¦                                                    |
| `@ide.show`         | `ide.show({path: string; beside: boolean})`    | æ‰“å¼€æŒ‡å®šçš„æ–‡ä»¶, å‚æ•°ä¸ºéœ€è¦æ‰“å¼€æ–‡ä»¶çš„è·¯å¾„, åŠæ˜¯å¦åœ¨ä¾§è¾¹æ‰“å¼€æ–‡ä»¶                              |

### `Raccoon æŒ‡ä»¤`

ä½¿ç”¨ `Raccoon æŒ‡ä»¤` å¯ä»¥æ–¹ä¾¿çš„è°ƒç”¨ Raccoon æä¾›çš„è¿œç«¯è¯­è¨€æ¨¡å‹ã€æœ¬åœ°ä»£ç†ç­‰èƒ½åŠ›ï¼Œè¦ä½¿ç”¨ `Raccoon æŒ‡ä»¤`ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªä»£ç å•å…ƒæ ¼ï¼Œå¹¶ä¿è¯å…¶è¯­è¨€ç±»å‹æ˜¯ `raccoon`ï¼Œåœ¨å•å…ƒæ ¼å†…ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å½¢å¼æ¥è°ƒç”¨èƒ½åŠ›ï¼š

```raccoon
// è°ƒç”¨ llm çš„ assistant èƒ½åŠ›å›ç­”ç”¨æˆ·é—®é¢˜
@llm.assistant // æŒ‡ä»¤æ ¼å¼ `@<module>.<function>`
messages: [{role: "user", content: "å°†'ä½ å¥½'ç¿»è¯‘æˆè‹±æ–‡"}] // é€šè¿‡ `output[]` æ¥ä½¿ç”¨æŒ‡å®šçš„ä¸Šæ–‡ä¿¡æ¯
```

ä¿è¯ç½‘ç»œå’Œç™»å½•çŠ¶æ€æ­£å¸¸ï¼Œæ‰§è¡Œä»¥ä¸Šå•å…ƒæ ¼ï¼Œå³å¯è·å–è¿œç«¯è¯­è¨€æ¨¡å‹çš„å›å¤ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨åç»­å•å…ƒæ ¼ä¸­ä½¿ç”¨ `output` åŠ `outputs` æ¥å¼•ç”¨ä¸Šæ–‡è¾“å‡º:

```raccoon
@llm.assistant
messages: [...outputs, {role: "user", content: "é‚£æ³•è¯­å‘¢?"}] // é€šè¿‡ `outputs` æ¥ä½¿ç”¨ä¸Šæ–‡å…¨éƒ¨ä¿¡æ¯
```

`Raccoon æŒ‡ä»¤` æœ¬è´¨æ˜¯å°†æŒ‡ä»¤è½¬è¯‘ä¸ºä¸‹æ–‡å°†ä¼šä»‹ç»çš„ `TypeScript` ä»£ç æ‰§è¡Œï¼Œå¯ä»¥ç‚¹å‡»å•å…ƒæ ¼åº•éƒ¨ `ğŸ¦` å¯æŸ¥çœ‹è½¬è¯‘ç»“æœã€‚

è¾“å‡ºç»“æœæ˜¾ç¤ºå½¢å¼å¯ä»¥é€šè¿‡è¾“å‡ºå•å…ƒæ ¼å‰çš„é…ç½®èœå•ï¼ŒæŒ‰å–œå¥½åˆ‡æ¢:

* `JSON (text/x-json)`: å°†è¾“å‡ºçš„ `Message` ä¿¡æ¯ä»¥ `JSON` æ ¼å¼æ¸²æŸ“
* `Markdown (text/markdown)`: å°†è¾“å‡ºçš„ `Message` ä¿¡æ¯ä»¥ `Markdown` æ ¼å¼æ¸²æŸ“

### `TypeScript` ä»£ç 

ä¸ºäº†å®ç°å…·ä½“åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥åœ¨åˆ›å»º `Typescript` ç±»å‹çš„ä»£ç å•å…ƒæ ¼ï¼Œå¹¶å®ç°ç¬¦åˆä»¥ä¸‹åˆçº¦å½¢å¼çš„ä»£ç ï¼š

```ts
(context: RaccoonContext): Promise<Message> => {
  return context.llm.assistant({messages: [{role: 'user', content: "ç ç©†æœ—ç›å³°æµ·æ‹”æ˜¯å¤šå°‘?"}]})
}
```

```ts
(context: RaccoonContext): Promise<Message> => {
  return context.llm.assistant({messages: [{role: 'user', content: "ä¹åŠ›é©¬æ‰ç½—å³°æµ·æ‹”æ˜¯å¤šå°‘?"}]})
}
```

å€ŸåŠ© `TypeScript` çš„å¼ºå¤§è¡¨è¾¾èƒ½åŠ›ï¼Œæ‚¨å¯ä»¥è‡ªå®šä¹‰å®ç°æ›´å¤šåŠŸèƒ½ï¼Œæ¯”å¦‚ç”¨ä»¥ä¸‹ä»£ç è®¡ç®—æµ·æ‹”å·®ï¼š

```ts
// æµ·æ‹”å·®è®¡ç®—å™¨
(context: RaccoonContext): Promise<Message> => {
  return new Promise<Message>((resolve, reject) => {
    let h1 = /([0-9,]+)ç±³/.exec(context.output[21].content);
    let h2 = /([0-9,]+)ç±³/.exec(context.output[22].content);
    if (h1 && h2) {
      let h1num = parseInt(h1[0].replace(',', ''));
      let h2num = parseInt(h2[0].replace(',', ''));
      resolve({ role: 'ğŸ’»', content: `${h1num} - ${h2num} = ${h1num - h2num}` });
    }
  });
}
```

### ä¸æœ¬åœ° IDE äº’åŠ¨

é€šè¿‡ä¸æœ¬åœ° IDE çš„åŠŸèƒ½é›†æˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Raccoon Notebook ä¸ IDE äº’åŠ¨ï¼š

```raccoon
@ide.files
recursive: 2
```

```raccoon
@ide.select
items: output[27].content.split('\n')
title: "open file..."
```

```raccoon
@ide.select
items: ['yes', 'no']
title: "open beside?"
```

```raccoon
@ide.show
path: output[28].content
beside: output[29].content === 'yes'
```

